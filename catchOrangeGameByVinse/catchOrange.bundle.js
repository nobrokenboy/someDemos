Array.prototype.remove=function(d){for(var c=0;c<this.length;c++){var a=this[c];if(!isNaN(d)){a=c}if(a==d){for(var b=c;b<this.length;b++){this[b]=this[b+1]}this.length=this.length-1}}};function gameStart(k){var m=function(q,r){var p=Object.prototype.toString.call(r).slice(8,-1);return r!==undefined&&r!==null&&p===q};var g=function(p){p=p||{};for(var r=1;r<arguments.length;r++){var s=arguments[r];if(!s){continue}for(var q in s){if(s.hasOwnProperty(q)){if(m("Object",s[q])&&s[q]!==null){g(p[q],s[q])}else{p[q]=s[q]}}}}return p};var o=document.body.scrollHeight,c=document.body.scrollWidth;var h={root:"img/",fps:30,gameTime:10,waitTime:3,fontFamily:"Impact",bg:"bg.jpg",menu:"menu.png",menuBtn:"menu-btn.png",hero:["orange.png","red.png","green.png","boom.png"],bang:"bang.png",readyFrame:"frame.png",overWrap:"over-wrapper.png",overBtn:"gameover.png",reStartBtn:"gamestart.png",onOver:function(){}};g(h,k);h.bg=h.root+h.bg;h.menu=h.root+h.menu;h.menuBtn=h.root+h.menuBtn;h.hero=[h.root+"orange.png",h.root+"red.png",h.root+"green.png",h.root+"boom.png"];h.bang=h.root+h.bang;h.readyFrame=h.root+h.readyFrame;h.overWrap=h.root+h.overWrap;h.overBtn=h.root+h.overBtn;h.reStartBtn=h.root+h.reStartBtn;var f=false;var l=[{name:"普通橙子",image:h.hero[0],width:120,score:10,speed:10,rate:30,textFill:"#ff8000"},{name:"红色橙子",image:h.hero[1],width:100,score:20,speed:15,rate:20,textFill:"#cd00da"},{name:"绿色橙子",image:h.hero[2],width:110,score:30,speed:25,rate:10,textFill:"#00dc05"},{name:"炸弹",image:h.hero[3],width:120,score:-15,speed:13,rate:20,textFill:"#da0000"}];var i=oCanvas.create({canvas:"#canvas",fps:h.fps,disableScrolling:true});i.height=o;i.width=c;d();function d(){var q=i.display.image({x:i.width/2,y:i.height/2-25,origin:{x:"center",y:"center"},image:h.menu});var p=i.display.image({x:i.width/2,y:i.height/2+130,origin:{x:"center",y:"center"},image:h.menuBtn});p.bind("click tap",function(){n()});i.addChild(q);i.addChild(p);i.canvas.canvas.style.backgroundImage="url("+h.bg+")"}function n(){i.reset();var q=i.display.rectangle({x:0,y:0,width:i.width,height:i.height,fill:"rgba(0,0,0,0.8)"});var s=i.display.image({x:i.width/2-100,y:i.height/2-100,width:200,height:200,image:h.readyFrame});var r=i.display.text({x:i.width/2,y:i.height/2-45,origin:{x:"center",y:"top"},font:"100px "+h.fontFamily+"",text:h.waitTime,fill:"#ff8000",});var p=setInterval(function(){var t=parseInt(r.text);if(t==1){r.text="GO";i.draw.redraw();clearInterval(p);b();return}r.text=t-1;i.draw.redraw()},1000);i.addChild(q);i.addChild(s);i.addChild(r)}function e(p){var q=parseInt(Math.random()*100);if(q<p){return true}else{return false}}function a(){var p=l[Math.floor((Math.random()*l.length))];p.x=Math.round(Math.random()*i.width);p.y=Math.round(Math.random()*80);p.origin={x:"center",y:"center"};p.drag=false;return p}function b(){f=false;i=oCanvas.create({canvas:"#canvas",fps:h.fps,disableScrolling:true});var t=0;var p=i.display.text({x:100,y:50,origin:{x:"center",y:"top"},font:"bold 32px "+h.fontFamily+"",text:"SCORE :",fill:"#0aa",zIndex:100,});var r=i.display.text({x:175,y:38,origin:{x:"left",y:"top"},font:"bold 48px "+h.fontFamily+"",text:t,fill:"#0aa",zIndex:100,});var u=i.display.text({x:i.width-90,y:38,origin:{x:"left",y:"top"},font:"bold 48px "+h.fontFamily+"",text:h.gameTime,fill:"#0aa",zIndex:100,});var s=setInterval(function(){u.text=parseInt(u.text)-1;if(u.text==1){f=true}if(!u.text){window.clearInterval(s);j(t)}},1000);i.addChild(p);i.addChild(r);i.addChild(u);var q=[];i.setLoop(function(){var v=a();if(e(v.rate)&&!f){var x=i.display.image(v);x.dragAndDrop({start:function(){this.drag=true},end:function(){t+=this.score;if(t<0){t=0}r.text=t;if(this.score<0){var z=this;var B=i.display.image({x:z.x-50,y:z.y-50,width:50,image:h.bang});var y=i.display.text({x:z.x,y:z.y,origin:{x:"center",y:"center"},font:"bold 66px "+h.fontFamily+"",text:z.score,fill:z.textFill,});i.addChild(B);i.addChild(y);i.removeChild(z);B.animate({width:220,height:225,opacity:0,},{duration:500,easing:"linear",callback:function(){i.removeChild(B)}});y.animate({x:this.x+20,y:this.y-20,opacity:0,},{duration:500,easing:"linear",callback:function(){i.removeChild(B)}})}else{var A=this;var y=i.display.text({x:A.x,y:A.y,origin:{x:"center",y:"center"},font:"bold 66px "+h.fontFamily+"",text:"+"+A.score+"",fill:A.textFill,});i.addChild(y);y.animate({x:this.x+20,y:this.y-20,opacity:0,},{duration:500,easing:"linear",callback:function(){i.removeChild(y)}});this.animate({width:this.width/1.8,height:this.height/1.8,opacity:0,},{duration:200,easing:"linear",callback:function(){i.removeChild(this)}})}}});i.addChild(x);q.push(x)}for(var w=0;w<q.length;w++){if(!q[w].drag){q[w].rotation+=10;q[w].y+=q[w].speed;if(q[w].y>i.height-parseInt(q[w].width/2)){i.removeChild(q[w]);q[w]=""}}}for(var w=0;w<q.length;w++){if(q[w]==""){q.remove(w)}}}).start()}function j(s){var q=i.display.rectangle({x:0,y:0,opacity:0,width:i.width,height:i.height,fill:"rgba(0, 0, 0, 0.5)",stroke:"inside 10px rgba(0, 0, 0, 0.5)"});var t=i.display.image({x:i.width/2,y:-200,width:680,height:450,origin:{x:"center",y:"center"},image:h.overWrap});var p=i.display.image({x:20,y:105,origin:{x:"left",y:"center"},image:h.overBtn,});var r=i.display.image({x:-20,y:105,origin:{x:"right",y:"center"},image:h.reStartBtn,});p.bind("click tap",function(){h.onClose(s)});r.bind("click tap",function(){n()});i.addChild(q);i.addChild(t);t.addChild(p);t.addChild(r);q.fadeIn(500,"linear",function(){i.timeline.stop()});t.animate({y:i.height/2.2,},{duration:500,easing:"linear"})}};